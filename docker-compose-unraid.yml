# NOTE: This file uses PRE-BUILT images from GitHub Container Registry.
# It downloads ready-to-run containers. No building required.

services:
  browserless:
    image: ghcr.io/browserless/chromium:latest
    container_name: forum_browserless
    restart: unless-stopped
    ports:
      - "3010:3000"
    environment:
      - TIMEOUT=60000
    networks:
      - unraid_sniper_net

  backend:
    # Pulls the image built by GitHub Actions
    image: ghcr.io/r0m1k3/inscripflow-backend:main
    container_name: forum_backend
    restart: unless-stopped
    ports:
      - "4010:4000"
    volumes:
      - forum_sniper_data:/app/data
      # Only mapping config/data, code is inside the image
      # COMMENTED OUT: If you didn't git clone the repo, these bind mounts will break the app.
      # We will rely on the internal files for now. Data will be reset on container recreation.
      #- ./server/targets.json:/app/targets.json
      #- ./server/settings.json:/app/settings.json
    environment:
      - BROWSERLESS_HOST=browserless
      - PORT=4000
    depends_on:
      - browserless
    networks:
      - unraid_sniper_net
    # Image already has CMD ["npm", "run", "dev"] or "start", we can stick to default or override
    command: npm start

  frontend:
    # Pulls the image built by GitHub Actions
    image: ghcr.io/r0m1k3/inscripflow-frontend:main
    container_name: forum_frontend
    restart: unless-stopped
    ports:
      - "5173:5173"
    environment:
      - VITE_API_URL=
    networks:
      - unraid_sniper_net
    # Ensure host bind for access outside container
    command: npm run dev -- --host

networks:
  unraid_sniper_net:
    driver: bridge

volumes:
  forum_sniper_data:


